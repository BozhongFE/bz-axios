import t from"@tarojs/taro";function r(t){return function(t,r){return Object.prototype.toString.call(t).indexOf(r)>=0}(t,"Array")}function e(t){return void 0!==t.url}var o=function t(r,e,o,n,a,i){void 0===e&&(e={}),void 0===o&&(o={}),void 0===a&&(a=!1),this.params={},this.ajaxHeaders={},this.debug=!1,this.withCredentials=!0;var s=Object.create(t.prototype);return this.params=e,this.ajaxHeaders=o,this.debug=a,this.withCredentials=i,this.handleRequestor(n,s),this.createMethods(r,s)};o.prototype.createMethods=function(t,r){var o=this,n=function(t,a){for(var i in t){var s=t[i];"string"==typeof s?o.createRequest(r,a,i,s):e(s)?o.createRequest(r,a,i,s.url,s.type):(a[i]||(a[i]={}),n(s,a[i]))}};return n(t,r),r},o.prototype.createRequest=function(t,e,o,n,a){void 0===a&&(a="get");var i=function(r){return function(e,o){return t._requestProxy(n,r,e,o)}},s=[];r(a)?s.push.apply(s,a):s.push(a);var u=s.some((function(t){return/get/gi.test(t)}));u&&(e[o]=i("get")),u||e[o]||(e[o]={}),s.forEach((function(t){e[o][t.toUpperCase()]=i(t)}))},o.prototype.handleRequestor=function(t,r){var e,o=this.params,n=this.ajaxHeaders,a=this.debug,i=this.withCredentials;switch(t.name){case"AxiosRequest":e=new t(o,n,a,i);break;case"TaroRequest":e=new t(o,n,a);break;default:e=new t(o,n,a)}for(var s in["_requestProxy","_res","_defaultError","_networkError"].forEach((function(r){Object.defineProperty(e,r,{get:function(){return t.prototype[r]},enumerable:!0})})),e)"constructor"!==s&&(r[s]=e[s]);return r};var n=function(t){void 0===t&&(t=!1),this.debug=t};n.prototype._getUrlParams=function(t){var r=t,e=r.indexOf("?"),o={};return-1!==e?((r=r.substr(e+1)).split("&").forEach((function(t){var r=t.split("=");o[r[0]]=r[1]})),o):o},n.prototype._setUrlParam=function(t,r){if(void 0===r&&(r={}),!t)return t;var e=Object.assign(this._getUrlParams(t),r),o=t.indexOf("?");return(-1!==o?t.substring(0,o):t)+"?"+Object.keys(e).map((function(t){return t+"="+r[t]})).join("&")},n.prototype._shunt=function(){for(var t=this,r=[],e=arguments.length;e--;)r[e]=arguments[e];return function(){for(var e=[],o=arguments.length;o--;)e[o]=arguments[o];r.forEach((function(r){"[object Function]"===Object.prototype.toString.call(r)&&r.apply(t,e)}))}},n.prototype._shuntAsync=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return function(){for(var r=[],e=arguments.length;e--;)r[e]=arguments[e];var o=0,n=function(){"[object Function]"===Object.prototype.toString.call(t[o])&&t[o].apply(t,r.concat((function(){(o+=1)<t.length&&n()})))};n()}},n.prototype._res=function(t,r,e,o,n){this.debug&&(console.log(t),this.debug=!1),0===t.error_code?r&&r(t):e?e(t):this._defaultError(t,"data"),o&&o(t),n&&n(t)},n.prototype._defaultError=function(t,r){return void 0===r&&(r="networkError"),"data"===r?console.log("格式异常："+(t&&"string"==typeof t?t:t.error_message)):console.error(t)},n.prototype._networkError=function(t,r){var e=this;return function(o){throw e._defaultError(o),r&&r(o),t&&t(o),new Error(o)}};var a=function(r){function e(t,e,o){void 0===o&&(o=!1),r.call(this,o),this.params=t,this.ajaxHeaders=e}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype._requestProxy=function(r,e,o,n){var a=this;void 0===e&&(e="get"),void 0===o&&(o={}),void 0===n&&(n={});var i=Object.assign({},this.params,o.data),s={"content-type":/form/gi.test(e)?"application/x-www-form-urlencoded":"application/json"},u=o.type||e,c={url:r,method:/form/gi.test(u)?"POST":u.toUpperCase(),header:s,data:i,dataType:"json"};for(var p in this.ajaxHeaders&&Object.assign(c.header,this.ajaxHeaders),n)Object.prototype.hasOwnProperty.call(n,p)&&(c[p]=n[p]);return new Promise((function(r,e){t.request(c).then((function(t){var e=o.success,n=o.error,i=o.complete,s=o.requestComplete;a._res(t.data,e,n,i,s),r(t)})).catch((function(t){var r=o.networkError,n=o.requestComplete;return e(t),a._networkError(r,n)}))}))},e}(n);export default function(t,r,e,n){return void 0===r&&(r={}),void 0===e&&(e={}),void 0===n&&(n=!1),new o(t,r,e,a,n)}
